<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Seed • Importar productos</title>
  <style>body{font-family:Arial;margin:20px} .ok{color:green} .err{color:red}</style>
</head>
<body>
  <h1>Importar productos iniciales</h1>
  <p>Iniciá sesión con el usuario admin para importar <b>productos</b> y <b>categorías</b> a Firestore.</p>
  <button id="login">Login admin</button>
  <button id="run" disabled>Importar</button>
  <pre id="log"></pre>

  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore-compat.js"></script>
  <script src="./config.js"></script>
  <script>
    firebase.initializeApp(FB_CONFIG);
    const AUTH = firebase.auth();
    const DB = firebase.firestore();
    const log = (m, cls='')=>{
      const el=document.getElementById('log'); 
      el.innerHTML += (cls?`<span class="${cls}">`:'')+m+(cls?'</span>':'')+'\n';
    };
    document.getElementById('login').onclick = ()=> AUTH.signInWithEmailAndPassword(ADMIN.mail, ADMIN.pass).then(()=>{
      document.getElementById('run').disabled=false;
      log('Login OK', 'ok');
    }).catch(e=>log('Login error: '+e.message, 'err'));
    document.getElementById('run').onclick = async ()=>{
      try{
        log('Cargando semilla...');
        const res = await fetch('./seed.json'); 
        const data = await res.json();
        const catsSet = new Set();
        for(const p of data){
          catsSet.add(p.categoria||'');
          const payload = {
            nombre: p.nombre||'',
            categoria: p.categoria||'',
            precio_final: Number(p.precio_final||p.precio||0),
            caracteristicas: p.caracteristicas||'',
            imagen: p.imagen||''
          };
          await DB.collection('productos').add(payload);
        }
        for(const c of Array.from(catsSet).filter(Boolean)){
          await DB.collection('categorias').add({nombre:c});
        }
        log('Importación completa', 'ok');
      }catch(e){
        log('Error: '+e.message, 'err');
      }
    };
  </script>
</body>
</html>
