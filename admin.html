<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Admin • Cell Distribuciones</title>
<style>
:root{--max:1100px;--green:#2ecc71;--border:#e5e5e5}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:#fafafa;color:#111}
header{background:#111;color:#fff;padding:12px}
.wrap{max-width:var(--max);margin:0 auto;display:flex;align-items:center;justify-content:space-between}
.main{max-width:var(--max);margin:16px auto;padding:0 12px}
.panel{background:#fff;border:1px solid var(--border);border-radius:10px;padding:12px;margin-bottom:12px}
.btn{padding:8px 12px;border:none;border-radius:8px;background:#111;color:#fff;cursor:pointer}
.btn.green{background:#2ecc71}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px}
.card{border:1px solid var(--border);border-radius:10px;padding:10px;background:#fff}
.small{font-size:12px;color:#666}
.login{max-width:420px;margin:40px auto;padding:12px;background:#fff;border-radius:10px;border:1px solid var(--border)}
input,select,textarea{width:100%;padding:8px;border:1px solid var(--border);border-radius:8px}
.preview{height:150px;background:#f1f1f1;border-radius:8px;display:flex;align-items:center;justify-content:center;overflow:hidden}
.preview img{max-width:100%;max-height:100%}
.row{display:flex;gap:8px;flex-wrap:wrap}
.modal-bg {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.6);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 999;
}
.modal {
  background: #fff;
  padding: 20px;
  border-radius: 10px;
  max-width: 500px;
  width: 100%;
}
.modal h3 {margin-top:0}
</style>
</head>
<body>
<header>
  <div class="wrap">
    <img src="logo.png" alt="Cell Distribuciones" style="height:28px;vertical-align:middle;">
    <button id="logout" class="btn">Salir</button>
  </div>
</header>

<main class="main">

  <div id="loginBox" class="login">
    <h3>Ingresar</h3>
    <input id="email" placeholder="Email">
    <input id="pass" placeholder="Contraseña" type="password">
    <button id="doLogin" class="btn green">Entrar</button>
  </div>

  <div id="tokenBox" class="login" style="display:none">
    <h3>Token de GitHub</h3>
    <p class="small">Pegá tu token con permiso <b>public_repo</b>. Se guarda localmente.</p>
    <input id="ghToken" placeholder="ghp_xxx..." autocomplete="off"><br><br>
    <button id="saveToken" class="btn green">Guardar Token</button>
  </div>

  <div id="app" style="display:none">
    <div class="panel">
      <h3>Categoría</h3>
      <div id="cats" class="row small" style="margin-top:8px"></div>
    </div>

    <div class="panel">
      <h3>Productos</h3>
      <input id="q" placeholder="Buscar...">
      <div id="list" class="grid" style="margin-top:10px"></div>
    </div>
  </div>

</main>

<div id="modalBg" class="modal-bg">
  <div class="modal">
    <h3>Editar producto</h3>
    <input id="pId" placeholder="ID">
    <input id="pNombre" placeholder="Nombre">
    <input id="pCat" placeholder="Categoría">
    <input id="pPrecio" placeholder="Precio base" type="number" step="0.01">
    <input id="pImagen" type="file" accept="image/*">
    <div id="pPreview" class="preview">Sin imagen</div>
    <textarea id="pSpecs" placeholder="Características" rows="4"></textarea>
    <div style="margin-top:8px; display:flex; gap:8px;">
      <button id="save" class="btn green">Guardar</button>
      <button id="closeModal" class="btn" style="background:#c0392b">Cerrar</button>
    </div>
  </div>
</div>

<script>
const USER = "districell";
const REPO = "distribuidora";
const BRANCH = "main";
const FILE_PATH = "semilla.json";
let DATA = [];
let CATS = {"Cargadores":50};

// Lista completa de cargadores
const NEW_CARGADORES = [
  {nombre:"CARGADOR 12V POTENCIADO MOD 36 - ONLY - POWERED - LIGHTNING - BLANCO",categoria:"Cargadores",precio_final:2894.47,markup:50},
  {nombre:"CARGADOR 12V POTENCIADO MOD 36 - ONLY - POWERED - LIGHTNING - NEGRO",categoria:"Cargadores",precio_final:2894.47,markup:50},
  {nombre:"Combo 1 CARGADOR 12V POTENCIADO MOD 36 - ONLY - POWERED - LIGHTNING",categoria:"Cargadores",precio_final:23986.02,markup:50},
  {nombre:"ADAPTADOR-CARGADOR 12V MOD 38 XAEA - SPEED - PD + QC 3.0",categoria:"Cargadores",precio_final:5842.39,markup:50},
  {nombre:"CARGADOR 12V BOOSTER MODS-500 - 2 USB + CABLE TIPO C - ONLY - BLANCO",categoria:"Cargadores",precio_final:1289.82,markup:50},
  {nombre:"CARGADOR 12V BOOSTER MODS-500 - 2 USB + CABLE TIPO C - ONLY - NEGRO",categoria:"Cargadores",precio_final:1297.62,markup:50},
  {nombre:"CARGADOR 12V DRIFT MODS-501 - 2 USB + CABLE TIPO C - ONLY - BLANCO",categoria:"Cargadores",precio_final:2007.93,markup:50},
  {nombre:"CARGADOR 12V DRIFT MODS-501 - 2 USB + CABLE TIPO C - ONLY - KIT X 200",categoria:"Cargadores",precio_final:339693.88,markup:50},
  {nombre:"CARGADOR 12V DRIFT MODS-501 - 2 USB + CABLE TIPO C - ONLY - NEGRO",categoria:"Cargadores",precio_final:2007.93,markup:50},
  {nombre:"CARGADOR 12V GEAR MODS-504 - 1 USB 1 TC + CABLE TIPO C - ONLY - NEGRO",categoria:"Cargadores",precio_final:2009.89,markup:50},
  {nombre:"CARGADOR 12V MOD 33 ECO 3.1 AMP - RIDE - ONLY - TIPO C",categoria:"Cargadores",precio_final:2258.85,markup:50},
  {nombre:"CARGADOR 12V POTENCIADO MOD 37 - ONLY - POWERED - TIPO C - NEGRO",categoria:"Cargadores",precio_final:2747.01,markup:50},
  {nombre:"CARGADOR 12V POTENCIADO MOD 37 - ONLY - POWERED -TIPO C - BLANCO",categoria:"Cargadores",precio_final:2747.01,markup:50},
  {nombre:"COMBO 2 - CARGADOR 12V POTENCIADO MOD 37 - ONLY - POWERED -TIPO C",categoria:"Cargadores",precio_final:21842.04,markup:50},
  {nombre:"COMBO 4 - CARGADOR 12V MOD 33 ECO 3.1 AMP - RIDE - ONLY - TIPO C",categoria:"Cargadores",precio_final:21172.08,markup:50},
  {nombre:"CARGADOR 12V MOD 33 ECO 3.1 AMP - RIDE - ONLY - V8",categoria:"Cargadores",precio_final:2133.44,markup:50},
  {nombre:"CARGADOR 12V MOD 40 - ONLY - BOOST- V8 - BLANCO",categoria:"Cargadores",precio_final:1297.70,markup:50},
  {nombre:"CARGADOR 12V POTENCIADO MOD 35 - ONLY - POWERED - V8 - NEGRO",categoria:"Cargadores",precio_final:2590.17,markup:50},
  {nombre:"CARGADOR 12V POTENCIADO MOD 35 - ONLY - POWERED - V8 - BLANCO",categoria:"Cargadores",precio_final:2590.17,markup:50},
  {nombre:"COMBO 3 - CARGADOR 12V POTENCIADO MOD 35 - ONLY - POWERED - V8",categoria:"Cargadores",precio_final:21975.97,markup:50},
  {nombre:"COMBO 5 - CARGADOR 12V MOD 33 ECO 3.1 AMP - RIDE - ONLY - V8",categoria:"Cargadores",precio_final:21306.01,markup:50},
  {nombre:"CARGADOR 220V MODO-006 - 2 USB + CABLE LIGHTNING - ONLY - BLANCO",categoria:"Cargadores",precio_final:3559.77,markup:50},
  {nombre:"CARGADOR 220V MODO-A015 INTENSIFY - 2USB + CABLE LIGHTNING - XAEA - BLANCO",categoria:"Cargadores",precio_final:3473.33,markup:50},
  {nombre:"CARGADOR 220V MODO-B015 INTENSIFY - 3USB + CABLE LIGHTNING - XAEA - BLANCO",categoria:"Cargadores",precio_final:3429.76,markup:50},
  {nombre:"CARGADOR 220V ONLY MOD 02 - 2 USB + CABLE LIGHTINING - BLANCO",categoria:"Cargadores",precio_final:6362.78,markup:50},
  {nombre:"CARGADOR 220V ONLY MOD 06 - 2 USB + CABLE LIGHTNING - BLANCO",categoria:"Cargadores",precio_final:3501.43,markup:50},
  {nombre:"CARGADOR 220V LETS MOD08 - 4,4 A - 3 USB + CABLE TIPO C - BLANCO",categoria:"Cargadores",precio_final:2679.29,markup:50},
  {nombre:"CARGADOR 220V LETS MOD08 - 4,4A - 2 USB + CABLE TIPO C - BLANCO",categoria:"Cargadores",precio_final:2881.07,markup:50},
  {nombre:"CARGADOR 220V MODO-006 - 1USB + TIPO C - ONLY - NEGRO",categoria:"Cargadores",precio_final:2808.01,markup:50},
  {nombre:"CARGADOR 220V MODO-006 - 1USB + TIPO C - ONLY PREMIUM - BLANCO",categoria:"Cargadores",precio_final:2722.91,markup:50},
  {nombre:"CARGADOR 220V MODO-006 - 1USB + TIPO C BLANCO - ONLY - KIT X 200",categoria:"Cargadores",precio_final:573065.18,markup:50},
  {nombre:"CARGADOR 220V MODO-006 - 1USB + TIPO C NEGRO - ONLY - KIT X 200",categoria:"Cargadores",precio_final:573065.18,markup:50},
  {nombre:"CARGADOR 220V MODO-006 - 2USB + CABLE TC BLANCO - ONLY - KIT X 200",categoria:"Cargadores",precio_final:595305.04,markup:50},
  {nombre:"CARGADOR 220V MODO-006 - 2USB + CABLE TC NEGRO - ONLY - KIT X 200",categoria:"Cargadores",precio_final:578148.50,markup:50},
  {nombre:"CARGADOR 220V MODO-008 - 4,4A - 3USB + CABLE TIPO TC - ONLY",categoria:"Cargadores",precio_final:3302.31,markup:50},
  {nombre:"CARGADOR 220V MODO-008 BOOST - 4,4A - 3USB + CABLE TIPO C - ONLY - BLANCO",categoria:"Cargadores",precio_final:3053.25,markup:50},
  {nombre:"CARGADOR 220V MODO-018 4.8A - RUSH - 1USB + CABLE TIPO C - ONLY - BLANCO",categoria:"Cargadores",precio_final:1941.50,markup:50},
  {nombre:"CARGADOR 220V MODO-018 4.8A - RUSH - 1USB + CABLE TIPO C - ONLY - NEGRO",categoria:"Cargadores",precio_final:1710.37,markup:50},
  {nombre:"CARGADOR 220V MODO-040 IMPULSE - 2.1A + CABLE TIPO C - ONLY - BLANCO",categoria:"Cargadores",precio_final:1813.06,markup:50},
  {nombre:"CARGADOR 220V MODO-A015 INTENSIFY - 2USB + CABLE TIPO C - XAEA - BLANCO",categoria:"Cargadores",precio_final:3098.88,markup:50},
  {nombre:"CARGADOR 220V MODO-A015 INTENSIFY - 2USB + CABLE TIPO C - XAEA - BLANCO - KIT X 200",categoria:"Cargadores",precio_final:566501.69,markup:50},
  {nombre:"CARGADOR 220V MODO-B015 INTENSIFY - 3USB + CABLE TIPO C - XAEA",categoria:"Cargadores",precio_final:3039.05,markup:50},
  {nombre:"CARGADOR 220V MODO-B015 INTENSIFY - 3USB + CABLE TIPO C - XAEA - KIT X 200",categoria:"Cargadores",precio_final:571578.12,markup:50},
  {nombre:"CARGADOR 220V ONLY MOD 03 - 2,1 A - 1 USB + CABLE TIPO C - BLANCO",categoria:"Cargadores",precio_final:2356.15,markup:50},
  {nombre:"CARGADOR 220V ONLY MOD02 - 1 USB C/ CABLE TIPO C - BLANCO",categoria:"Cargadores",precio_final:3107.03,markup:50},
  {nombre:"CARGADOR 220V ONLY MOD06 - 2 USB + CABLE TC - BLANCO",categoria:"Cargadores",precio_final:2841.71,markup:50},
  {nombre:"CARGADOR 220V ONLY MOD06 - 2 USB + CABLE TC - NEGRO",categoria:"Cargadores",precio_final:2852.15,markup:50},
  {nombre:"CARGADOR 220V XAEA MOD 10 - 9V - 27W - 1 USB + CABLE TIPO C - BLANCO",categoria:"Cargadores",precio_final:4701.41,markup:50},
  {nombre:"CARGADOR 220V XAEA MOD 10 - 9V - 27W - 1 USB + CABLE TIPO C - BLANCO - KIT X 100",categoria:"Cargadores",precio_final:405974.26,markup:50}
];

function base64EncodeUtf8(str){return btoa(unescape(encodeURIComponent(str)));}
function fileToDataURL(f){return new Promise((res,rej)=>{const R=new FileReader();R.onload=()=>res(R.result);R.onerror=rej;R.readAsDataURL(f);});}

async function loadSeed(){
  try{ const r = await fetch(FILE_PATH+'?v='+Date.now()); DATA = await r.json(); }catch(e){DATA=[];}
  NEW_CARGADORES.forEach(c=>{if(!DATA.some(p=>p.nombre===c.nombre)){DATA.push({...c,id:Date.now().toString() + Math.random()});}});
  drawCats();
  draw();
}

async function saveToGitHub(content){
  const token = localStorage.getItem("gh_token");
  if(!token){ alert("Token no configurado."); return; }
  const api = `https://api.github.com/repos/${USER}/${REPO}/contents/${FILE_PATH}`;
  let sha = null;
  const getRes = await fetch(api,{headers:{Authorization:`Bearer ${token}`}});
  if(getRes.status===200){sha=(await getRes.json()).sha;}
  const body={message:"Actualizar semilla.json",content:base64EncodeUtf8(content),branch:BRANCH};
  if(sha) body.sha = sha;
  const putRes = await fetch(api,{method:"PUT",headers:{Authorization:`Bearer ${token}`},body:JSON.stringify(body)});
  if(!putRes.ok){alert("Error al guardar en GitHub");return;}
}

function drawCats(){
  const cont = document.getElementById('cats'); cont.innerHTML='';
  Object.keys(CATS).forEach(c=>{
    const box=document.createElement('div');
    box.innerHTML = `<b>${c}</b> (Markup: ${CATS[c]}%) `;
    const btn=document.createElement('button');btn.className='btn';btn.textContent='Eliminar';
    btn.onclick=async()=>{DATA=DATA.filter(p=>p.categoria!==c);delete CATS[c];draw();drawCats();await saveToGitHub(JSON.stringify(DATA,null,2));};
    box
    .appendChild(btn); cont.appendChild(box);
});
}

function draw(){
const list = document.getElementById('list'); list.innerHTML='';
const q = document.getElementById('q').value.toLowerCase();
DATA.filter(p=>p.categoria==="Cargadores" && p.nombre.toLowerCase().includes(q))
.forEach(p=>{
const card = document.createElement('div'); card.className='card';
card.innerHTML=<b>${p.nombre}</b><br>Precio final: $${p.precio_final.toFixed(2)}<br>Markup: ${p.markup}%;
list.appendChild(card);
});
