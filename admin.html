<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Admin • Cell Distribuciones</title>
<style>
:root{--max:1100px;--green:#28a745}
*{box-sizing:border-box}
body{font-family:Arial,Helvetica,sans-serif;margin:0;background:#f6f6f6;color:#111}
.header{background:#111;color:#fff;padding:12px 16px}
.header .wrap{max-width:var(--max);margin:0 auto;display:flex;align-items:center;justify-content:space-between}
.main{max-width:var(--max);margin:18px auto;padding:0 16px}
.panel{background:#fff;padding:12px;border-radius:10px;margin-bottom:12px;box-shadow:0 1px 3px rgba(0,0,0,.06)}
.row{display:flex;gap:12px;flex-wrap:wrap}
input,select,textarea{padding:8px;border:1px solid #ddd;border-radius:8px;width:100%}
.btn{padding:8px 10px;border:none;border-radius:8px;background:#111;color:#fff;cursor:pointer}
.btn.green{background:var(--green)}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:10px;margin-top:10px}
.card{padding:10px;border:1px solid #eee;border-radius:8px;background:#fff}
.small{font-size:12px;color:#666}
.login{max-width:420px;margin:40px auto;padding:12px;background:#fff;border-radius:8px}
</style>
</head>
<body>
<header class="header"><div class="wrap"><div>Admin • Cell Distribuciones</div><div><button id="logout" class="btn">Salir</button></div></div></header>
<main class="main">
  <div id="loginBox" class="login">
    <h3>Ingresar</h3>
    <input id="email" placeholder="Email" value="admin@celldistribuciones.com"><br><br>
    <input id="pass" placeholder="Contraseña" value="QWERTY123456" type="password"><br><br>
    <div><button id="doLogin" class="btn green">Entrar</button></div>
    <p class="small">Esta versión trabaja sin backend. Editá aquí y luego <b>descargá</b> el semilla.json para subirlo a tu repo.</p>
  </div>

  <div id="app" style="display:none">
    <div class="panel">
      <h3>Categorías</h3>
      <div style="display:flex;gap:8px;margin-bottom:8px"><input id="newCat" placeholder="Nueva categoría"><button id="addCat" class="btn">Agregar</button></div>
      <div id="cats" class="row small"></div>
    </div>

    <div class="panel">
      <h3>Producto</h3>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
        <input id="pId" placeholder="ID (dejar vacío para nuevo)">
        <input id="pNombre" placeholder="Nombre">
        <input id="pCat" placeholder="Categoría">
        <input id="pPrecio" placeholder="Precio final" type="number" step="0.01">
        <input id="pImagen" type="file" accept="image/*">
        <textarea id="pSpecs" placeholder="Características"></textarea>
      </div>
      <div style="margin-top:8px"><button id="saveProduct" class="btn green">Guardar</button> <button id="delProduct" class="btn" style="background:#c0392b">Eliminar</button></div>
    </div>

    <div class="panel">
      <h3>Productos</h3>
      <input id="q" placeholder="Buscar..."><div id="list" class="grid"></div>
    </div>

    <div class="panel">
      <h3>Exportar / Importar</h3>
      <button id="download" class="btn">Descargar semilla.json</button>
      <input type="file" id="uploadSeed" accept=".json">
    </div>
  </div>
</main>

<script>
let DATA = [];
function loadSeed(){
  return fetch('semilla.json?v='+Date.now()).then(r=>r.json()).then(d=>{ DATA = d; renderList(); renderCats(); return d; }).catch(e=>{ DATA=[]; renderList(); renderCats(); });
}

function renderCats(){
  const cats = Array.from(new Set(DATA.map(p=>p.categoria).filter(Boolean))).sort();
  const cont = document.getElementById('cats'); cont.innerHTML='';
  cats.forEach(c=>{ const s = document.createElement('div'); s.textContent = c + ' '; const btn = document.createElement('button'); btn.textContent='Eliminar'; btn.className='btn'; btn.style.marginLeft='8px'; btn.onclick = ()=>{ DATA = DATA.filter(p=>p.categoria!==c); renderList(); renderCats(); }; s.appendChild(btn); cont.appendChild(s); });
}

function renderList(q=''){
  const cont = document.getElementById('list'); cont.innerHTML='';
  const filtered = DATA.filter(p=> !q || (p.nombre||'').toLowerCase().includes(q.toLowerCase()));
  filtered.forEach(p=>{
    const card = document.createElement('div'); card.className='card';
    card.innerHTML = '<b>'+ (p.nombre||'') + '</b><div class="small">'+ (p.categoria||'') +'</div><div>$'+ Number(p.precio_final||p.precio||0).toLocaleString('es-AR',{minimumFractionDigits:2}) +'</div>';
    const btn = document.createElement('button'); btn.textContent='Editar'; btn.className='btn'; btn.style.marginTop='6px'; btn.onclick = ()=> fillForm(p.id);
    card.appendChild(btn);
    cont.appendChild(card);
  });
}

function fillForm(id){
  const p = DATA.find(x=>x.id==id); if(!p) return;
  document.getElementById('pId').value = p.id;
  document.getElementById('pNombre').value = p.nombre;
  document.getElementById('pCat').value = p.categoria;
  document.getElementById('pPrecio').value = p.precio_final || p.precio || 0;
  document.getElementById('pSpecs').value = p.caracteristicas || '';
}

document.getElementById('doLogin').onclick = ()=>{
  const e = document.getElementById('email').value.trim();
  const p = document.getElementById('pass').value;
  if(e==='admin@celldistribuciones.com' && p==='QWERTY123456'){ document.getElementById('loginBox').style.display='none'; document.getElementById('app').style.display='block'; loadSeed(); } else { alert('Credenciales incorrectas'); }
};

document.getElementById('addCat').onclick = ()=>{
  const v = document.getElementById('newCat').value.trim(); if(!v) return;
  DATA.push({id: Date.now().toString(), nombre:'(categoria placeholder)', categoria:v, precio:0, precio_final:0, caracteristicas:'', imagen:''});
  renderList(); renderCats();
};

document.getElementById('saveProduct').onclick = async ()=>{
  let id = document.getElementById('pId').value.trim();
  const nombre = document.getElementById('pNombre').value.trim();
  const categoria = document.getElementById('pCat').value.trim();
  const precio = Number(document.getElementById('pPrecio').value || 0);
  const caracteristicas = document.getElementById('pSpecs').value.trim();
  let imagen = '';
  const file = document.getElementById('pImagen').files[0];
  if(file){
    imagen = await toDataURL(file);
  }
  if(id){
    const idx = DATA.findIndex(x=>x.id==id);
    if(idx>=0){
      DATA[idx].nombre = nombre; DATA[idx].categoria = categoria; DATA[idx].precio_final = precio; DATA[idx].caracteristicas = caracteristicas; if(imagen) DATA[idx].imagen = imagen;
    } else {
      DATA.push({id, nombre, categoria, precio_final:precio, caracteristicas, imagen});
    }
  } else {
    id = Date.now().toString();
    DATA.push({id, nombre, categoria, precio_final:precio, caracteristicas, imagen});
  }
  renderList();
  renderCats();
  alert('Producto guardado en memoria. Luego descargá semilla.json y subilo al repo para que la tienda pública lo use.');
};

document.getElementById('delProduct').onclick = ()=>{
  const id = document.getElementById('pId').value.trim();
  if(!id) return alert('Ingresá ID');
  DATA = DATA.filter(x=>x.id!=id);
  renderList(); renderCats();
  alert('Eliminado en memoria. Descargar semilla.json y subir.');
};

document.getElementById('q').addEventListener('input', e=> renderList(e.target.value));

function toDataURL(file){
  return new Promise((res,rej)=>{
    const r = new FileReader();
    r.onload = ()=> res(r.result);
    r.onerror = rej;
    r.readAsDataURL(file);
  });
}

document.getElementById('download').onclick = ()=>{
  const data = JSON.stringify(DATA, null, 2);
  const blob = new Blob([data], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'semilla.json'; document.body.appendChild(a); a.click(); a.remove();
};

document.getElementById('uploadSeed').addEventListener('change', e=>{
  const f = e.target.files[0];
  if(!f) return;
  const r = new FileReader();
  r.onload = ()=>{
    try{
      const d = JSON.parse(r.result);
      if(Array.isArray(d)){
        DATA = d; renderList(); renderCats(); alert('Semilla cargada en memoria.');
      } else alert('Archivo JSON inválido');
    }catch(err){ alert('Error leyendo JSON: '+err.message); }
  };
  r.readAsText(f);
});

document.getElementById('logout').onclick = ()=> location.reload();
loadSeed();
</script>
</body>
</html>
